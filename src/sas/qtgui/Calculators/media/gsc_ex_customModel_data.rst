.. gsc_ex_customModel_data.rst

.. _gsc_ex_customModel_data:

Example: Fit the experimental data using the calculated $P(Q)$ from a PDB file 
==================================

In this example, the custom model function, custom_apoferritinLong, is written by the Generic Scattering Calculator using a PDB file for apoferritin. (The apoferritin PDB in this example can be accessed at https://www.rcsb.org/structure/6z6u ) In the Generic Scattering Calculator, one should choose the option, Debye full avg. w/ $\beta(Q)$, after loading the apoferritin PDB file. (See an example picture below.) This allows a person to set the low-Q and high-Q limit and the number of data points. Then one should check the box, Export Model, and fill the blank box with the file name of the custom plugin model. In this case, we can put custom_apoferritinLong into this box. After all these, click Compute to calculate $P(Q)$ and $\beta(Q)$, and generate the file into the plugin model directory of the SasView. Once the computation is finished, the plugin model is ready to use to fit scattering data.

.. figure:: gsc_ex_customModel_data_Fig1.jpg

In Fit panel, when one selects "Plugin Models" in the Categoery box, the custom model should already exsit in the SasView directroy and can be found in the drop down menu of the "Model name". This custom model, custom_apoferritinLong, returns the normalized form factor, $\tilde{P}(Q)$, and $\beta(Q)$ caculated using the PDB file. 
(Note that $\beta(Q)$ is only used if one needs to fit the data with the inter-particle structure factor, $S(Q)$, with the static decoupling approximation.)

Warning: When generating the data points using the Generic Scattering Calculator, please be careful about the follwoing two issues:
1) There should be $enough$ number of data points when generating the plugin model. Because the plugin model will calculate the theoretical $I(Q)$ by interpolating the data during the fitting, the more data points generated by the Generic Scattering Calculator, the more accurate the theoretical curves is. 2) Because each instrument has a resolution function for each $Q$ value, the theoretical curve needs to be calculated by considering the resolution function. Therefore, the $Q$ range given in the Generic Scattering Calculator should be larger than the $Q$ range of the experimental data. If the $Q$ range of theoretical data is too close to (or smaller than) that of the experimental data, the calculated theoretiecal values may all return as "NaN". When this happens, the plugin model will not be able to be used to fit an experimental data. 

The fitting GUI is shown in the following.

.. figure:: gsc_ex_customModel_data_Fig1.jpg

The scattering pattern, $I(Q)$, is calcualted as

.. math::
    I(\mathbf{Q}) = \frac{scale}{V}(SLD - SLD\_solvent)^2V_{protein} \tilde{P}(Q\alpha) + background

$SLD$ is the scattering length density of the protein (or particle). And $SLD\_solvent$ is the scatteirng length density of solvent. 

$V_{protein}$ is the protein volume. If the scattering length density and protein volume are assigned with correct values, $scale$ is the volume fraction of the protein ( or particle).

$\alpha$ is the swelling factor. In general, $\alpha$ should be one (or close to one). The parameter is introduced just in case that there is a slight swelling of the particle.

The following figure shows the comparison between one experimental apoferritin protein SANS data with the calculated $I(Q)$ using this model.

.. figure:: gsc_ex_customModel_data_Fig2.jpg


*Document History*

| 2023-10-30 Yun Liu

